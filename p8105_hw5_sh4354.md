Homework 5
================
Selina Hsuan
2023-11-14

## Problem 1

``` r
library(tidyverse)
library(p8105.datasets)
```

Download and clean data

``` r
homicides_df = 
  read_csv("data/homicide-data.csv", na = c("", "NA", "Unknown")) |> 
  janitor::clean_names() |> 
  mutate(
    city_state = str_c(city, state, sep = ", "),
    resolution = case_when(
      disposition == "Closed without arrest" ~ "unsolved",
      disposition == "Open/No arrest"        ~ "unsolved",
      disposition == "Closed by arrest"      ~ "solved"
    )
  ) |> 
    filter(city_state != "Tulsa, AL") 
```

Homicides solved by city_state

``` r
city_homicide_df = 
  homicides_df |> 
  select(city_state, disposition, resolution) |> 
  group_by(city_state) |> 
  summarize(
    hom_total = n(),
    hom_unsolved = sum(resolution == "unsolved"))
```

Proportion of homicides unsolved in Baltimore, MD

``` r
bmore_test = 
  prop.test(
    x = filter(city_homicide_df, city_state == "Baltimore, MD") |>  pull(hom_unsolved),
    n = filter(city_homicide_df, city_state == "Baltimore, MD") |>  pull(hom_total)) 

broom::tidy(bmore_test) |> 
  knitr::kable(digits = 3)
```

| estimate | statistic | p.value | parameter | conf.low | conf.high | method                                               | alternative |
|---------:|----------:|--------:|----------:|---------:|----------:|:-----------------------------------------------------|:------------|
|    0.646 |   239.011 |       0 |         1 |    0.628 |     0.663 | 1-sample proportions test with continuity correction | two.sided   |

Estimates and CIâ€™s for proportion of unsolved homicides in each city

``` r
test_results = 
  city_homicide_df |> 
  mutate(
    prop_tests = map2(hom_unsolved, hom_total, \(x, y) prop.test(x = x, n = y)),
    tidy_tests = map(prop_tests, broom::tidy)) |> 
    select(-prop_tests) |> 
    unnest(tidy_tests) |> 
    select(city_state, estimate, conf.low, conf.high) |> 
    mutate(city_state = fct_reorder(city_state, estimate))
```

Create plot showing the estimate (and CI) of the proportion of unsolved
homicides in each city

``` r
test_results |> 
  mutate(city_state = fct_reorder(city_state, estimate)) |> 
  ggplot(aes(x = city_state, y = estimate)) + 
  geom_point() + 
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

![](p8105_hw5_sh4354_files/figure-gfm/unnamed-chunk-6-1.png)<!-- -->

## Problem 2

``` r
list_participant = 
  list.files("data")
```

``` r
read_data = function(file) {
  data = read_csv(paste0("data/", file))
  return(data)
}
```

``` r
participant_df = 
  data.frame(file_name = list_participant) |> 
  mutate (data = map(file_name, read_data)) |> 
  unnest(data) |> 
  separate(file_name, into = c("study_arm", "subject_id"), sep = "_") |> 
  pivot_longer(week_1:week_8,
    names_to = "week", 
    values_to = "observation") |> 
  mutate(subject_id = str_replace(subject_id, ".csv", ""),
         week = str_replace(week, "week_", ""), 
         study_arm = case_when(
           study_arm == "con" ~ "control",
           study_arm == "exp" ~ "experimental"
         )) |> 
  mutate(subject_id_numeric = as.numeric(subject_id)) |> 
  mutate(subject_id_renumbered = case_when(
           study_arm == "experimental" ~ subject_id_numeric + 10,
           TRUE ~ subject_id_numeric))
## Warning: Expected 2 pieces. Missing pieces filled with `NA` in 52179 rows [21, 22, 23,
## 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, ...].
```

``` r
participant_df |> 
  ggplot(aes(x = week, y = observation, color = study_arm, group = subject_id_renumbered)) + 
  geom_line() +
  labs(title = "Study Results", 
        x = "Week",
        y = "Observation", 
       color = "Study Arm")
## Warning: Removed 417432 rows containing missing values (`geom_line()`).
```

![](p8105_hw5_sh4354_files/figure-gfm/unnamed-chunk-10-1.png)<!-- -->

The spaghetti plot shows that longitudinal observations from Week 1 to
Week 8 have higher values overall in the experimental arm compared to
the control arm. There appears to be an upward trend in observation
values for the experimental arm, while observation values for the
control arm fluctuate around the same range.

## Problem 3
